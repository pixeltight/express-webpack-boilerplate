!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.Brushstroke=e()}(this,function(){function t(t,e,i,n){"use strict";function s(t,e,n,s){for(var o,r=2;n>r;r+=2){var a,l,d,c,f=t[r],p=t[r+1],m=t[r+2],g=t[r+3],v=(m-t[r-2])*s,x=(g-t[r-1])*s,y=(t[r+4]-f)*s,_=(t[r+5]-p)*s,w=0;for(o=0;i>o;o++)a=e[w++],l=e[w++],d=e[w++],c=e[w++],u[h++]=a*f+l*m+d*v+c*y,u[h++]=a*p+l*g+d*x+c*_}}e="number"==typeof e?e:.5,i="number"==typeof i?i:25;var o,r=1,a=t.length,h=0,l=(a-2)*i+2+(n?2*i:0),u=new Float32Array(l),d=new Float32Array(4*(i+2)),c=4;for(o=t.slice(0),n?(o.unshift(t[a-1]),o.unshift(t[a-2]),o.push(t[0],t[1])):(o.unshift(t[1]),o.unshift(t[0]),o.push(t[a-2],t[a-1])),d[0]=1;i>r;r++){var f=r/i,p=f*f,m=p*f,g=2*m,v=3*p;d[c++]=g-v+1,d[c++]=v-g,d[c++]=m-2*p+f,d[c++]=m-p}return d[++c]=1,s(o,d,a,e),n&&(o=[],o.push(t[a-4],t[a-3],t[a-2],t[a-1],t[0],t[1],t[2],t[3]),s(o,d,4,e)),a=n?0:t.length-2,u[h++]=t[a++],u[h]=t[a],u}function e(t,e,i){v.fnc(t)&&t.call(e,i)}function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t){t||(t={});for(var e=1;e<arguments.length;e++)i(t,arguments[e]);return t}function s(t,e){try{return!v.und(e)&&!v.obj(e)&&!v.fnc(e)&&e.length>0&&e!=parseInt(e)&&t!=parseInt(t)}catch(i){return!1}}function o(t){var e=getComputedStyle(t),i="";for(var n in e)s(n,e[n])&&(i+=n+":"+e[n]+";");t.style.cssText+=i+";visibility:visible;"}function r(t,e){for(var i=t.children,n=0;n<i.length;n++)r(i[n],e);e.push({el:t,style:t.style.cssText}),o(t)}function a(t){for(var e,i=0;i<t.length;i++)e=t[i],e.style?e.el.style.cssText=e.style:e.el.removeAttribute("style")}function h(t){var e=[];r(t,e);var i=t.outerHTML;return a(e),i}function l(t){var e=getComputedStyle(t),i=e.getPropertyValue("position");"static"===i&&(t.style.position="relative")}function u(t){var e=t.el.getBoundingClientRect(),i=t.root.getBoundingClientRect();t.top=e.top-i.top,t.left=e.left-i.left}function d(){return new function(){this.resolve=null,this.reject=null,this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this))}}function c(t,e,i){for(var n=t||10,s=[],o=0;n>o;o++)s.push(e*Math.random()*.9+.05*e|0,i*Math.random()*.9+.05*i|0);return s}function f(t,e){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var n=i.getContext("2d");if(e.stretch)n.drawImage(t,0,0,e.width,e.height);else{var s=t.width,o=t.height,r=e.width/2-s/2,a=e.height/2-o/2;n.drawImage(t,r,a,s,o)}return i}function p(t){t.el&&(t.width=t.el.offsetWidth,t.height=t.el.offsetHeight,u(t));var e=document.createElement("canvas");e.style.position="absolute",e.style.top=t.top+"px",e.style.left=t.left+"px",e.width=t.width,e.height=t.height,e.style.visibility="hidden",t.canvas=e,t.ctx=e.getContext("2d"),l(t.root),t.root.appendChild(t.canvas)}function m(t){this.defaults={animation:"to-bottom",path:void 0,points:void 0,frameAnimation:!1,frames:0,duration:0,delay:0,color:"#ccc",width:300,height:120,size:40,inkAmount:1,lifting:!1,dripping:!1,splashing:!0,padding:30,overlap:10,tension:.5,reduceOverflow:20,root:document.body,el:void 0,image:void 0,repeat:"no-repeat",stretch:!1,centered:!1,queue:!1},this.init(t)}if(document.getElementById("canvas_root")){var g=function(){function t(t,e,i,n,s,o,r,a){this.x=t||0,this.y=e||0,void 0!==i&&(this.color=i),void 0!==n&&(this.size=n),void 0!==s&&(this.inkAmount=s),void 0!==o&&(this.angle=o),void 0!==r&&(this.dripping=r),void 0!==a&&(this.splashing=a),this._drops=[],this._resetTip()}function e(t,e,i,n){this.x=t||0,this.y=e||0,this.inkAmount=i,this.color=n,this._latestPos={x:this.x,y:this.y}}function i(t,e,i,n,s){this.x=t||0,this.y=e||0,this.size=i,this.color=n,this.strokeId=s,this.life=1.5*this.size,this._latestPos={x:this.x,y:this.y}}return t.prototype={_SPLASHING_BRUSH_SPEED:75,angle:0,x:0,y:0,color:"#000",size:35,inkAmount:7,splashing:!0,dripping:!0,maxHairs:1e3,_latestPos:null,_strokeId:null,_drops:null,isStroke:function(){return!!this._strokeId},startStroke:function(){this.isStroke()||(this._resetTip(),this._strokeId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e,i;return e=16*Math.random()|0,i="x"===t?e:3&e|8,i.toString(16)}))},endStroke:function(){this._strokeId=this._latestPos=null},render:function(t,e,n){var s,o,r,a,h=this.isStroke();if(this._latestPos||(this._latestPos={}),this._latestPos.x=this.x,this._latestPos.y=this.y,this.x=e,this.y=n,this._drops.length){var l,u=this._drops,d=this.size*this.size;for(r=0,a=u.length;a>r;r++)l=u[r],s=this.x-l.x,o=this.y-l.y,h&&d>s*s+o*o&&this._strokeId!==l.strokeId||l.life<=0?(u.splice(r,1),a--,r--):l.render(t)}if(h){{var c,f=this._tip;this._strokeId}if(s=this.x-this._latestPos.x,o=this.y-this._latestPos.y,c=Math.sqrt(s*s+o*o),this.splashing&&c>this._SPLASHING_BRUSH_SPEED){var p,m,g,v,x,y=.5*(c-this._SPLASHING_BRUSH_SPEED)|0;for(t.save(),t.fillStyle=this.color,t.beginPath(),r=0,a=y*Math.random()|0;a>r;r++)p=(c-1)*Math.random()+1,m=2*Math.PI*Math.random(),g=5*Math.random(),v=this.x+p*Math.sin(m),x=this.y+p*Math.cos(m),t.moveTo(v+g,x),t.arc(v,x,g,0,2*Math.PI,!1);t.fill(),t.restore()}else this.dripping&&c<2*this.inkAmount&&Math.random()<.05&&this._drops.push(new i(this.x,this.y,.5*(this.size+this.inkAmount)*(.15*Math.random()+.1),this.color,this._strokeId));for(r=0,a=f.length;a>r;r++)f[r].render(t,s,o,c)}},dispose:function(){this._tip.length=this._drops.length=0},_resetTip:function(){var t,i,n,s,o,r,a,h,l,u,d=this._tip=[],c=.5*this.size;for(r=this.angle,u=c*c*Math.PI/this.inkAmount|0,1>u&&(u=1),u>this.maxHairs&&(u=this.maxHairs),l=0;u>l;l++)t=c*Math.random(),i=.5*t,n=2*Math.PI*Math.random(),s=t*Math.sin(n),o=i*Math.cos(n),a=Math.cos(r),h=Math.sin(r),d.push(new e(this.x+s*a-o*h,this.y+s*h+o*a,this.inkAmount,this.color))}},e.prototype={x:0,y:0,inkAmount:7,color:"#000",_latestPos:null,render:function(t,e,i,n){this._latestPos.x=this.x,this._latestPos.y=this.y,this.x+=e,this.y+=i;var s=n?this.inkAmount/n:0;s>1?s=1:0>s&&(s=0),t.save(),t.lineCap=t.lineJoin="round",t.strokeStyle=this.color,t.lineWidth=this.inkAmount*s,t.beginPath(),t.moveTo(this._latestPos.x,this._latestPos.y),t.lineTo(this.x,this.y),t.stroke(),t.restore()}},i.prototype={x:0,y:0,size:7,color:"#000",strokeId:null,life:0,_latestPos:null,_xOffRatio:0,render:function(t){Math.random()<.03?this._xOffRatio+=.06*Math.random()-.03:Math.random()<.1&&(this._xOffRatio*=.003),this._latestPos.x=this.x,this._latestPos.y=this.y,this.x+=this.life*this._xOffRatio,this.y+=.5*this.life*Math.random(),this.life-=.04*Math.random()+.01,t.save(),t.lineCap=t.lineJoin="round",t.strokeStyle=this.color,t.lineWidth=this.size+.3*this.life,t.beginPath(),t.moveTo(this._latestPos.x,this._latestPos.y),t.lineTo(this.x,this.y),t.stroke(),t.restore(),t.restore()}},t}(),v={obj:function(t){return Object.prototype.toString.call(t).indexOf("Object")>-1},num:function(t){return"number"==typeof t},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t},und:function(t){return void 0===t}};return m.prototype={init:function(t){var e=n(this.defaults,t);v.str(e.root)&&(e.root=document.querySelector(e.root)),v.str(e.el)&&(e.el=document.querySelector(e.el)),p(e);var i=d();this.promise=i.promise,i.resolve()},run:function(t){function i(){t.canvas.style.visibility="visible",t.render?n.render(t):e(n.animations[t.animation],n,t)}var n=this;if(t.clear)t.ctx.clearRect(0,0,t.width,t.height),t.d.resolve();else if(t.el)if(t.pattern)i();else{var s="<style>body{margin:0;}</style>"+h(t.el);rasterizeHTML.drawHTML(s,null).then(function(e){t.fill?(t.ctx.drawImage(e.image,0,0,t.width,t.height),t.d.resolve()):(t.pattern=t.ctx.createPattern(e.image,t.repeat),i())},function(t){console.log("rasterizeHTMLError: "+t)})}else if(t.image){var o=new Image;o.onload=function(){(t.stretch||t.centered)&&(o=f(o,t)),t.fill?(t.ctx.drawImage(o,0,0,t.width,t.height),t.d.resolve()):(t.pattern=t.ctx.createPattern(o,t.repeat),i())},o.src=t.image}else i()},draw:function(t){var e=this,i=n({},this.defaults,t),s=function(){var t=d();return e.run(n(i,{d:t})),t.promise};i.queue?this.promise=this.promise.then(s):s()},erase:function(t){this.draw(n({},t,{erase:!0}))},fill:function(t){this.draw(n({},t,{fill:!0}))},clear:function(t){this.draw(n({},t,{clear:!0}))},setPath:function(t){var e=t.path;v.str(e)&&(e=document.createElementNS("http://www.w3.org/2000/svg","path"),e.setAttribute("d",t.path),t.path=e),t.pathLenght=e.getTotalLength()},pointAt:function(t,e){switch(e.animation){case"points":var i=e.points,n=i.length,s=2*Math.round(n*t/2);return n>s||(s=n-2),{x:i[s],y:i[s+1]};case"path":return e.path.getPointAtLength(e.pathLenght*t);default:return null}},setPos:function(t,e){var i=!e;switch(i&&(e={}),t.direction){case"bottom":e.startY=i?t.padding:e.startY+t.size-t.overlap,this.setPosBottomTop(t,e,i);break;case"top":e.startY=i?t.height-t.padding:e.startY-t.size+t.overlap,this.setPosBottomTop(t,e,i);break;case"right":e.startX=i?t.padding:e.startX+t.size-t.overlap,this.setPosRightLeft(t,e,i);break;case"left":e.startX=i?t.width-t.padding:e.startX-t.size+t.overlap,this.setPosRightLeft(t,e,i)}return e},setPosBottomTop:function(t,e,i){if(i)e.vertical=!0;else var n=e.startX;e.startX=i?t.padding:e.x,e.x=i?t.width-t.padding:n,e.y=e.startY},setPosRightLeft:function(t,e,i){if(i)e.vertical=!1;else var n=e.startY;e.x=e.startX,e.startY=i?t.padding:e.y,e.y=i?t.height-t.padding:n},render:function(t){if(!v.und(t.duration)||!v.und(t.frames)){var i=this;if(t.delay){var n=t.delay;return delete t.delay,void setTimeout(function(){i.render(t)},1e3*n)}t.erase&&(t.ctx.globalCompositeOperation="destination-out");var s,o,r,a,h=1,l=0,u=0,d=new Date;v.und(t.startX)||(l=t.startX),v.und(t.startY)||(u=t.startY);var c=new g(l,u,t.pattern||t.color,t.size,t.inkAmount,t.angle,t.dripping,t.splashing);c.startStroke(l,u),e(t.begin),t.frameAnimation&&t.duration&&(t.frames||(t.frames=60*parseFloat(t.duration)),delete t.duration),function f(){t.duration?(s=(new Date-d)/1e3,o=s/parseFloat(t.duration)):o=h/parseFloat(t.frames),r=o,v.fnc(t.easing)&&(r=t.easing(r)),o>1&&(r=1),a=i.pointAt(r,t),a||(a={x:l+(t.x-l)*r,y:u+(t.y-u)*r}),l=a.x,u=a.y,c.render(t.ctx,l,u),1>o?t.duration?requestAnimationFrame(f):(h++,t.frameAnimation?requestAnimationFrame(f):f()):(c.endStroke(),t.erase&&(t.ctx.globalCompositeOperation="source-over"),e(t.end),t.d.resolve())}()}},animations:{"to-bottom":function(t){e(this.animations.basic,this,n(t,{direction:"bottom"}))},"to-top":function(t){e(this.animations.basic,this,n(t,{direction:"top"}))},"to-right":function(t){e(this.animations.basic,this,n(t,{direction:"right"}))},"to-left":function(t){e(this.animations.basic,this,n(t,{direction:"left"}))},basic:function(t){function i(t){0===m&&(a[t]=a[t]-p),1===m&&(a[t]=a[t]+p),m===h-1&&(a[t]=f?a[t]+p:a[t]-p)}for(var s,o,r,a=this.setPos(t),h=Math.ceil(((a.vertical?t.height:t.width)+t.size/2-2*t.padding)/(t.size-t.overlap)),l=a.vertical?.5*Math.PI:0,u=t.duration/h,d=t.frames/h,c=[],f=!0,p=t.reduceOverflow,m=0;h>m;m++)t.lifting?(o=0===m,r=m===h-1,s=n({},t,a,{duration:u,frames:d,angle:l,render:!0,queue:!0}),o||(s.begin=null),r||(s.end=null),this.draw(s)):(p&&i(a.vertical?"x":"y"),c.push(a.startX,a.startY,a.x,a.y)),this.setPos(t,a),f=!f;t.lifting?t.d.resolve():e(this.animations.points,this,n(t,{animation:"points",points:c,angle:l}))},path:function(t){this.setPath(t);var e=this.pointAt(0,t);this.render(n(t,{startX:e.x,startY:e.y}))},points:function(e){var i=e.points||0;i=v.num(i)?c(i,e.width,e.height):i,i=t(i,e.tension),this.render(n(e,{points:i,startX:i[0],startY:i[1]}))}}},m}}),function(){function t(){i.draw({points:[0,r/2-40,o,r/3]}),i.draw({points:[o,r/2,0,r/1.5-40]}),i.draw({points:[0,r/1.5+40,o,r/1.5]});for(var t=0,e=0;e<s.length;e++)n.draw({path:s[e],delay:t}),t+=.5}if(document.getElementById("canvas_root")){var e,i,n,s=document.querySelectorAll("path"),o=(document.querySelector("button"),673),r=551,a=document.getElementById("canvas_root");e={animation:"points",points:10,inkAmount:5,size:300,frames:10,frameAnimation:!0,splashing:!0,image:"/static/frozen.jpg",centered:!0,queue:!0,width:o,height:r,root:a},i=new Brushstroke(e),t()}}();